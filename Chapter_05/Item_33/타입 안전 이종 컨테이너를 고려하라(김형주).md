## ğŸ¤” ì»¨í…Œì´ë„ˆ(Container)?

- ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê°ì²´ë¥¼ ë§í•œë‹¤.
- ex) `Set<E>`, `Map<K,V>` ê°ê° ê°’ì„ ì €ì¥í•˜ëŠ” ì»¨í…Œì´ë„ˆì´ë‹¤.

í•˜ë‚˜ì˜ ì»¨í…Œì´ë„ˆì—ì„œ ë§¤ê°œë³€ìˆ˜í™”í•  ìˆ˜ ìˆëŠ” íƒ€ì…ì˜ ìˆ˜ëŠ” ì œí•œë˜ì–´ìˆë‹¤.

- `Set`ì—ëŠ” ì›ì†Œì˜ íƒ€ì…ì„ ëœ»í•˜ëŠ” **ë‹¨ 1ê°œì˜ íƒ€ì… ë§¤ê°œë³€ìˆ˜**ë§Œ ìˆìœ¼ë©´ ëœë‹¤.
- `Map`ì—ëŠ” í‚¤ì™€ ê°’ì˜ íƒ€ì…ì„ ëœ»í•˜ëŠ” **2ì˜ ë§¤ê°œë³€ìˆ˜**ê°€ í•„ìš”í•˜ë‹¤.
- ê° ë§¤ê°œë³€ìˆ˜ê°€ ì •í•´ì§€ë©´, ì»¨í…Œì´ë„ˆì—ëŠ” **í•´ë‹¹ íƒ€ì…ì˜ ìš”ì†Œë§Œ ë„£ì„ ìˆ˜ ìˆë‹¤.**

#### ë” ìœ ì—°í•œ ê²ƒì„ ì›í•œë‹¤ë©´?

ë°ì´í„°ë² ì´ìŠ¤ì˜ í–‰ì€ ë‹¤ì–‘í•œ íƒ€ì…ì˜ ì—´ì„ ê°€ì§€ê³  ìˆë‹¤.

ì´ì²˜ëŸ¼ **í•œ ì»¨í…Œì´ë„ˆì— ì—¬ëŸ¬ê°œì˜ íƒ€ì…ì„ ë„£ê³  ì‹¶ê³ , ì•ˆì „í•˜ê²Œë„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´** ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

## ğŸ¤·â€â™‚ï¸ íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ íŒ¨í„´

> ì˜ˆì‹œ

```java
Map<String, Integer> map1 = new HashMap<>();     // ì»¨í…Œì´ë„ˆ ë§¤ê°œë³€ìˆ˜í™”
Map<Class<?>, Object> map2 = new HashMap<>();    // ì»¨í…Œì´ë„ˆì˜ í‚¤ë¥¼ ë§¤ê°œë³€ìˆ˜í™”
```

- **ì»¨í…Œì´ë„ˆì˜ í‚¤ë¥¼ ë§¤ê°œë³€ìˆ˜í™”ì—¬**, í•´ë‹¹ í‚¤ë¡œ ì»¨í…Œì´ë„ˆ ê°’ì„ ë„£ê±°ë‚˜ ë¹¼ëŠ” ë°©ì‹ì´ë‹¤.

## ğŸ¥ íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ íŒ¨í„´ ì˜ˆì‹œ

> íƒ€ì…ë³„ë¡œ ì¦ê²¨ ì°¾ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•˜ëŠ” Favorites í´ë˜ìŠ¤

```java
public class Favorites {
  private Map<Class<?>, Object> favorites = new HashMap<>();

  public <T> void putFavorite(Class<T> type, T instance) {
    favorites.put(Objects.requireNonNull(type), instance);
  }

  public <T> T getFavorite(Class<T> type) {
    return type.cast(favorites.get(type));
  }
}
````

#### HashMap : favorites 

- í‚¤ê°€ Class<?>ì´ë””,
    - ëª¨ë“  í‚¤ê°€ ì„œë¡œ ë‹¤ë¥¸ ë§¤ê°œë³€ìˆ˜í™” íƒ€ì…ì¼ ìˆ˜ ìˆë‹¤.
    - ex) ì²«ë²ˆì§¸ `class<String>` / ë‘ë²ˆì§¸ `class<Integer>`


- `favorites`ì˜ ê°’ íƒ€ì…ì´ Objectì´ë‹¤.
    - í‚¤ì™€ ê°’ ì‚¬ì´ì— íƒ€ì… ê´€ê³„ë¥¼ ë³´ì¦í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ëª¨ë“  ê°’ì´ í‚¤ë¡œ ëª…ì‹œí•œ íƒ€ì…ì„ì„ ë³´ì¦í•˜ì§€ ì•ŠëŠ”ë‹¤.


#### putFavorite()

```java
public static void main(String[] args) {
    final Favorites favorite = new Favorites();

    favorite.putFavorite(Integer.class, 123);
    favorite.putFavorite(String.class, 123);   // ì»´íŒŒì¼ ì—ëŸ¬
}
```

- ì£¼ì–´ì§„ íƒ€ì…ì„ í‚¤ë¡œ í•´ì„œ favoritesì— ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤.
- Të¡œ typeê³¼ ì¸ìŠ¤í„´ìŠ¤ì˜ íƒ€ì…ì„ ì¼ì¹˜ì‹œì¼°ì§€ë§Œ, í‚¤ì™€ ê°’ ì‚¬ì´ì˜ `íƒ€ì…ë§í¬`ì •ë³´ëŠ” ëŸ°íƒ€ì„ë•Œ ì‚¬ë¼ì§„ë‹¤. 
- ì¦‰, ì¸ìŠ¤í„´ìŠ¤ê°€ í‚¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ë¼ëŠ” ì •ë³´ë„ ì‚¬ë¼ì§„ë‹¤.
- í•˜ì§€ë§Œ ë‹¤ìŒì— ë‚˜ì˜¬ getFavorite()ì—ì„œ ì´ ê´€ê³„ë¥¼ ë˜ì‚´ë ¤ì¤€ë‹¤.

#### getFavorite()

- ì£¼ì–´ì§„ typeìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ì„ ë°˜í™˜í•´ì¤€ë‹¤.
- Object íƒ€ì…ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— Të¡œ casting í•´ì¤˜ì•¼ í•œë‹¤.
- ì´ë•Œ cast()ë¥¼ ì‚¬ìš©í•´ Class<T>ìœ¼ë¡œ ë™ì  í˜•ë³€í™˜í•˜ì—¬, **ì¸ìŠ¤í„´ìŠ¤ê°€ í‚¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤**ë¼ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

> cast ë©”ì„œë“œ ì •ë³´ ë° ë™ì‘

```java
public final class Class<T>{
    ...
    public T cast(Object obj) {
        if (obj != null && !isInstance(obj))
            throw new ClassCastException(cannotCastMsg(obj));
        return (T) obj;
    }
    ...
}
```

```java
public static void main(String[] args) {
    final Favorites favorite = new Favorites();
    // 1. ê°•ì œë¡œ ( í‚¤ : Integer.class , ì¸ìŠ¤í„´ìŠ¤ : String )ë¥¼ ë„£ì—ˆë‹¤.
    favorite.putFavorite((Class)Integer.class,"String ë„£ì„ê±°ë‹¤");
              
    // 2. cast()ê°€ ì‚¬ìš©ëœ getFavorite()ë¥¼ Integer.classë¥¼ íƒ€ì…ìœ¼ë¡œ ë„£ì–´ì„œ ì‚¬ìš©í•´ë³´ì•˜ë‹¤.
    final Integer result = favorite.getFavorite(Integer.class); 
}
```

> ì¶œë ¥ ê²°ê³¼

```
ClassCastException: Cannot cast java.lang.String to java.lang.Integer
```

- cast()ëŠ” ì£¼ì–´ì§„ ì¸ìŠ¤í„´ìŠ¤ê°€  Class ê°ì²´ê°€ ì•Œë ¤ì£¼ëŠ” íƒ€ì…ê³¼ ë™ì¼í•œì§€ ê²€ì‚¬í•œë‹¤.
- ì¼ì¹˜í•œë‹¤ë©´ ê·¸ëŒ€ë¡œ ë°˜í™˜í•˜ê³ , ì¼ì¹˜í•˜ì§€ ì•Šë‹¤ë©´ ClassCastExceptionë¥¼ ë˜ì§„ë‹¤.
- ì¦‰, **ì¸ìŠ¤í„´ìŠ¤ê°€ í‚¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤**ë¼ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

#### Main

ì´ì œ ì´ í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•´ë³´ì.

```java
public static void main(String[] args) {
    final Favorites favorite = new Favorites();

    favorite.putFavorite(String.class, "Java");
    favorite.putFavorite(Integer.class, 0xcafebebe);
    favorite.putFavorite(Class.class, Favorites.class);

    String favoriteString = favorite.getFavorite(String.class);
    int favoriteInteger = favorite.getFavorite(Integer.class);
    Class<?> favoriteClass = favorite.getFavorite(Class.class);

    System.out.println("favoriteString = " + favoriteString);   // Java
    System.out.println("favoriteInteger = " + favoriteInteger);  // 0xcafebebe : -889274690
    System.out.println("favoriteClass = " + favoriteClass.getName()); // Item_33.Favorites
}
```

- Favorites ì¸ìŠ¤í„´ìŠ¤ëŠ” íƒ€ì… **ì•ˆì „í•˜ë‹¤.**
- Stringì„ ìš”ì²­í–ˆëŠ”ë° Integerë¥¼ ë°˜í™˜í•˜ëŠ” ì¼ì´ ì ˆëŒ€ ì—†ë‹¤.

ì´ì²˜ëŸ¼ íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ íŒ¨í„´ëŠ” ë‹¤ì–‘í•œ íƒ€ì…ì„ ë‹¤ë£¨ëŠ” ì¸¡ë©´ì—ì„œ ìœ ì—°í•˜ê³  ì•ˆì „í•˜ë‹¤.

## ğŸ‘€ ì œì•½ì‚¬í•­

ì´ëŸ¬í•œ íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ íŒ¨í„´ì—ë„ ì œì•½ì‚¬í•­ì€ ì¡´ì¬í•œë‹¤.

### 1. Keyë¡œ ë¡œíƒ€ì…ì„ ë„˜ê¸°ë©´ ì»¨í…Œì´ë„ˆì˜ íƒ€ì… ì•ˆì •ì„±ì´ ì‰½ê²Œ ê¹¨ì§„ë‹¤.

ì•ì—ì„œ ì´ë¯¸ ì˜ˆì‹œë¡œ ë‚˜ì™”ë‹¤.

```java
public static void main(String[] args) {
    ...
    // ( í‚¤ : Integer.class , ì¸ìŠ¤í„´ìŠ¤ : String ) ë¡œíƒ€ì…ìœ¼ë¡œ ë„£ì—ˆë‹¤.
    favorite.putFavorite((Class)Integer.class,"String ë„£ì„ê±°ë‹¤");
    
    //ë¹„ìŠ·í•œ ì›ë¦¬
    final HashSet integerSet = new HashSet<>();
    integerSet.add(10);
    integerSet.add("Stringë„ ë“¤ì–´ê°„ë‹¤~.");
}
```

<p align = "center">
<img width="552" alt="image" src="https://github.com/kim0527/Effective-Java/assets/143387515/eb2336f6-1dde-4fb2-8915-bed623a23148">
</p>

- ìœ„ ì˜ˆì‹œì²˜ëŸ¼ ë¡œíƒ€ì…ìœ¼ë¡œ ëŒ€ì…ì‹œ Stringì´ ë“¤ì–´ê°€ì ¸ ì»¨í…Œì´ë„ˆë¥¼ ë”ëŸ½íŒë‹¤.
- ë¹„ê²€ì‚¬ ê²½ê³ ê°€ ë°œìƒí•œë‹¤.
- HashSetê³¼ HashMapë“±ì˜ ì¼ë°˜ êµ¬í˜„í…Œì—ë„ ë¡œíƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ ì—¬ëŸ¬ íƒ€ì…ì´ ë“¤ì–´ê°€ì§€ëŠ” ê²ƒê³¼ ë™ì¼í•œë‹¤.

#### í•´ê²°ë°©ë²•ì€ ê°„ë‹¨í•œë‹¤.

```java
//before
public <T> void putFavorite(Class<T> type, T instance) {
    favorites.put(Objects.requireNonNull(type), instance);     
  }

//after
public <T> void putFavorite(Class<T> type, T instance) {
	favorites.put(Objects.requireNonNull(type), type.cast(instance));    //instanceì˜ íƒ€ì… ê²€ì‚¬
}
```

- ì•ì—ì„œ ë°°ìš´ cast()ë¥¼ ì´ìš©í•´ì„œ ê°’ì˜ íƒ€ì…ì„ í•œë²ˆ ê²€ì¦ í•´ì£¼ë©´ ëœë‹¤.

```java
static class CheckedList<E> extends CheckedCollection<E> implements List<E> {
    ...
    public void add(int index, E element) {
        list.add(index, typeCheck(element));   //type ê²€ì‚¬
    }
    ...
}

static class CheckedCollection<E> implements Collection<E>, Serializable {
    E typeCheck(Object o) {
        if (o != null && !type.isInstance(o))
            throw new ClassCastException(badElementMsg(o));
        return (E) o;
    }
}
```

- `checkedSet`, `checkedList`, `checkedMap`ì´ ì´ëŸ¬í•œ íƒ€ì… ê²€ì‚¬ê°€ ì ìš©ëœ ì»¬ë ‰ì…˜ì´ë‹¤.
- ëŸ°íƒ€ì„ë•Œ ë‹¤ë¥¸ íƒ€ì…ì´ ë“¤ì–´ê°€ëŠ” ê²ƒì„ ClassCastExceptionìœ¼ë¡œ ë°©ì§€í•œë‹¤. 

### 2. ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì€ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

- List<String>ì™€ ê°™ì€ ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì€ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥ í•˜ë‹¤.
- List<String>, List<Integer> ëª¨ë‘ `List.class`ë¼ëŠ” class ê°ì²´ë¥¼ ê³µìœ í•œë‹¤.
- ì¦‰, List<String>, List<Integer>ë¥¼ êµ¬ë¶„í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.

> ìŠˆí¼ íƒ€ì… í† í°ì„ ì‚¬ìš©í•˜ë©´ ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ë„ ë¬¸ì œì—†ì´ ì €ì¥ ê°€ëŠ¥í•˜ë‹¤. 
> í•˜ì§€ë§Œ ì´ ë˜í•œ í•œê³„ê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— "ì™„ë²½íˆ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ìš°íšŒë¡œëŠ” ì—†ë‹¤"ë¼ê³  ë§í•œë‹¤.

## âœ… ì¶”ê°€  : í•œì •ì  íƒ€ì… í† í°ê³¼ & asSubclass()

> í† í°ì´ë€?
> ì»´íŒŒì¼íƒ€ì„ íƒ€ì… ì •ë³´ì™€ ëŸ°íƒ€ì„ íƒ€ì… ì •ë³´ë¥¼ ì•Œì•„ë‚´ê¸° ìœ„í•´ ë©”ì„œë“œë“¤ì´ ì£¼ê³ ë°›ëŠ” í´ë˜ìŠ¤ ë¦¬í„°ëŸ´ì„ ë§í•œë‹¤.

ìœ„ Favoritesê°€ ì‚¬ìš©í•˜ëŠ” íƒ€ì… í† í°ì€ ë¹„í•œì •ì ì´ë¼, ì–´ë–¤ Class ê°ì²´ë“  ë°›ì•„ë“¤ì¸ë‹¤.

ì´ë¥¼ ì œí•œí•˜ê³  ì‹¶ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

ì´ë•Œ í•œì •ì  íƒ€ì… í† í°ì„ í™œìš©í•˜ë©´ íƒ€ì…ì„ ì œí•œí•  ìˆ˜ ìˆë‹¤.

> AnnotatedElement ì¸í„°í˜ì´ìŠ¤

```java
public interface AnnotatedElement {
    <T extends Annotation> T getAnnotation(Class<T> annotationClass);   
}
```

- annotation Type ì¸ìˆ˜ëŠ” ì• ë„ˆí…Œì´ì…˜ íƒ€ì…ì„ ëœ»í•˜ëŠ” í•œì •ì  íƒ€ì… í† í°ì´ë‹¤.
- ì´ ë©”ì„œë“œì—ì„œëŠ” í† í°ìœ¼ë¡œ ëª…ì‹œí•œ íƒ€ì…ì˜ ì• ë„ˆí…Œì´ì…˜ì´ í•´ë‹¹ ìš”ì†Œì— ë‹¬ë ¤ìˆë‹¤ë©´ ì• ë„ˆí…Œì´ì…˜ì„ ë°˜í™˜í•˜ê³  ì—†ìœ¼ë©´ nullì„ ë°˜í™˜í•œë‹¤.
- ì• ë„ˆí…Œì´ì…˜ëœ ìš”ì†ŒëŠ” í‚¤ê°€ ì• ë„ˆí…Œì´ì…˜ íƒ€ì…ì¸ íƒ€ì… ì•ˆì • ì´ì¢… ì»¨í…Œì´ë„ˆì´ë‹¤.

#### Class<?> íƒ€ì…ì˜ ê°ì²´ê°€ ìˆê³ , ì´ë¥¼ í•œì •ì  íƒ€ì… í† í°ì„ ë°›ëŠ” ë©”ì„œë“œì— ë„˜ê¸°ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?

ë‘ê°€ì§€ ë°©ë²•ì´ ì¡´ì¬í•œë‹¤.

1. `Class<? extends Annotation>`ìœ¼ë¡œ í˜•ë³€í™˜.
2. **asSubclass ë©”ì„œë“œ ì‚¬ìš©**

> asSubclass ì‚¬ìš© ì˜ˆì‹œ

```java
static Annotation getAnnotation(AnnotatedElement element, String annotationTypeName) {
    Class<?> annotationType = null; 
    try {
        annotationType = Class.forName(annotationTypeName);
    } catch (Exception ex) {
        throw new IllegalArgumentException(ex);
    }
    return element.getAnnotation(annotationType.asSubclass(Annotation.class));   //asSubclass() ì‚¬ìš©
}
```

- í˜¸ì¶œëœ ì¸ìŠ¤í„´ìŠ¤ ìì‹ ì˜ Class ê°ì²´ë¥¼ ì¸ìˆ˜ê°€ ëª…ì‹œí•œ í´ë˜ìŠ¤ë¡œ í˜•ë³€í™˜í•œë‹¤.
- í˜•ë³€í™˜ì— ì„±ê³µí•˜ë©´ ì¸ìˆ˜ë¡œ ë°›ì€ í´ë˜ìŠ¤ ê°ì²´ë¥¼ ë°˜í™˜í•˜ê³  ì‹¤íŒ¨í•˜ë©´ ClassCastExceptionì„ ë˜ì§„ë‹¤.

### ğŸƒâ€â™‚ï¸ ì •ë¦¬

- í•œ ì»¨í…Œì´ë„ˆì— ì—¬ëŸ¬ íƒ€ì…ì„ ì•ˆì „í•˜ê²Œ ë‹¤ë£¨ê³  ì‹¶ë‹¤ë©´, **íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ**ë¥¼ ê³ ë ¤í•´ë³´ì.
- Classë¥¼ í‚¤ë¡œ ì‚¬ìš©í•˜ë©°, ì´ë¥¼ íƒ€ì… í† í°ì´ë¼ê³  í•œë‹¤.
- ìŠˆí¼íƒ€ì… í† í°ìœ¼ë¡œëŠ” ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì˜ Classë¥¼ ë°›ì„ ìˆ˜ ìˆê³ , ì •ì  íƒ€ì… í† í°ìœ¼ë¡œ ì œí•œë„ í•  ìˆ˜ ìˆë‹¤.

### ğŸ“š Reference 

- [ìŠˆí¼íƒ€ì… í† í° - 1 ](https://g-egg.tistory.com/95)
  
- [ìŠˆí¼íƒ€ì… í† í° - 2 ](https://ka0oll.tistory.com/6)
