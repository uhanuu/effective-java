ì œë„¤ë¦­ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ë©´ ì™œ ì¢‹ì€ì§€ ì˜ˆì‹œë¡œ ì•Œì•„ë³´ì.

## ğŸ§‘â€ğŸ’» ì˜ˆì‹œ

> Object ê¸°ë°˜ Stack í´ë˜ìŠ¤

```java
public class Stack {
    private Object[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;
    
    public Stack() {
        elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }
    
    public void push(Object e) {
        ensureCapacity();
        elements[size++] = e;
    }
    
    public Object pop() {
        if (size == 0
            throw new EmptyStackException();
        Object result = elements[--size];
        elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
        return result;
    }
    
    public boolean isEmpty() {
        return size == 0;
    }
    
    private void ensureCapacity() {
        if (elements.length == size)
            elements = Arrays.copyOf(elements, 2 * size + 1);
    }
}
```

> Main

```java
class Pizza{...}
class Chicken{...}

public static void main(String[] args) {
    final Stack pizzaStack = new Stack();

    final Pizza pizza1 = new Pizza();
    final Pizza pizza2 = new Pizza();
    final Pizza pizza3 = new Pizza();

    pizzaStack.push(pizza1);
    pizzaStack.push(pizza2);
    pizzaStack.push(pizza3);

    //1. í˜•ë³€í™˜ì„ ë§¤ë²ˆ í•´ì¤˜ì•¼í•œë‹¤.
    final Pizza result = (Pizza) pizzaStack.pop();

    //2. ë‹¤ë¥¸ íƒ€ì…ì´ ë“¤ì–´ê°€ë„ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ X
    final Chicken chicken = new Chicken();
    pizzaStack.push(chicken);
}
```

- Stackì— ë„£ì€ ê°ì²´ë¥¼ êº¼ë‚¼ë•Œ, ë§¤ë²ˆ `í˜•ë³€í™˜`ì„ ì‹œë„í•´ì•¼í•œë‹¤.
- ë‹¤ë¥¸ ê°ì²´ê°€ ë“¤ì–´ê°€ë„ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œëŠ” ì˜¤ë¥˜ë¥¼ ë„ìš°ì§€ ëª»í•œë‹¤.
- ì¦‰, ëŸ°íƒ€ì„ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

## âœ… ê·¸ë ‡ë‹¤ë©´ ì´ì œ ì œë„¤ë¦­ íƒ€ì…ì„ ì ìš©í•´ë³´ì.

> ì œë„¤ë¦­ ê¸°ë°˜ Stack í´ë˜ìŠ¤

```java
public class Stack<E> {
    private E[] elements;
    private int size = 0;
    private static final int DEFAULT_INITIAL_CAPACITY = 16;

    public Stack() {
        elements = new Object[DEFAULT_INITIAL_CAPACITY];
    }

    public void push(E e) {
        ensureCapacity();
        elements[size++] = e;
    }

    public E pop() {
        if (size == 0)
            throw new EmptyStackException();
        E result = elements[--size];
        elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
        return result;
    }
    public boolean isEmpty() {
        return size == 0;
    }

    private void ensureCapacity() {
        if (elements.length == size)
            elements = Arrays.copyOf(elements, 2 * size + 1);
    }
}
```

- ì œë„¤ë¦­ íƒ€ì…ì„ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ë‹¤.
- í´ë˜ìŠ¤ ì´ë¦„ ì˜†ì— íƒ€ì… ë§¤ê°œ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ê³ , í•´ë‹¹ ë§¤ê°œë³€ìˆ˜ íƒ€ì…ì´ ì‚¬ìš©ë˜ëŠ” ê³³ì—ë„ ì ìš©í•˜ë©´ ëœë‹¤.
- Typeì˜ ê²½ìš° `<T>`, Elementì˜ ê²½ìš° `<E>`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

<p align = "center">
<img width="689" alt="image" src="https://github.com/Growth-Hub/Effective-Java/assets/143387515/79d6a951-edca-47eb-b491-b47fab9f3070">
</p>

- í•˜ì§€ë§Œ ê·¸ë ‡ê²Œ í–ˆë”ë‹ˆ, ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.
- ì œë„¤ë¦­ íƒ€ì…ì€ ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ìœ¼ë¡œ ë°°ì—´ì„ ë§Œë“¤ ìˆ˜ ì—†ê¸° ë–„ë¬¸ì— ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì´ë‹¤. (Item 28)

## ğŸ§‘â€ğŸ’» í•´ê²° ë°©ì•ˆ

### ì²«ë²ˆì§¸ í•´ê²°ë°©ì•ˆ

> Objectë°°ì—´ì„ ìƒì„±í•œ ë‹¤ìŒì— ì œë„¤ë¦­íƒ€ì… ë°°ì—´ë¡œ í˜•ë³€í™˜

```java
// Before
public Stack() {
    elements = new Object[DEFAULT_INITIAL_CAPACITY];
}
// After
public Stack() {
    elements = (E[]) new Object[DEFAULT_INITIAL_CAPACITY];   // ì œë„¤ë¦­ íƒ€ì… ë°°ì—´ë¡œ í˜•ë³€í™˜
}
```

<p align = "center">
<img width="689" alt="image" src="https://github.com/Growth-Hub/Effective-Java/assets/143387515/d91b0ecb-7ee5-46c1-8411-7d3cb9dadcad">
</p>

- ê·¸ë¬ë”ë‹ˆ ì´ë²ˆì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.
- `(E[])`ì´ ì•ˆì „ castingì¸ì§€ ì»´íŒŒì¼ëŸ¬ ì…ì¥ì—ì„œëŠ” ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ê²½ê³ ë¥¼ ë„ìš´ ê²ƒì´ë‹¤.
- ì´ ë¶€ë¶„ì€ ìš°ë¦¬ê°€ ì§ì ‘ ì•ˆì „í•œì§€ í™•ì¸í•´ì•¼ í•œë‹¤.

#### ì•ˆì „í•œì§€ ì§ì ‘ í™•ì¸í•´ë³´ì.

> 1ï¸âƒ£ privateìœ¼ë¡œ ì €ì¥ëœë‹¤.

```java
private E[] elements;
```

> 2ï¸âƒ£ ì €ì¥ë˜ëŠ” ì›ì†Œê°€ E íƒ€ì…ì´ë‹¤.

```java
public void push(E e) {         // ë§¤ê°œë³€ìˆ˜ E íƒ€ì…
    ensureCapacity();
    elements[size++] = e;    // E íƒ€ì… ì €ì¥
}
```

>  3ï¸âƒ£ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ í˜¹ì€ ë‹¤ë¥¸ ë©”ì„œë“œì— ì „ë‹¬ë˜ëŠ” ê²½ìš°ê°€ ì—†ë‹¤.

```java
public void push(E e) { ... }

public E pop() { ... }

public boolean isEmpty() {...}

private void ensureCapacity() {... }
```

ì´ë¡œì¨ í•´ë‹¹ í˜•ë³€í™˜ì€ ì•ˆì „í•˜ë‹¤ëŠ” ê²ƒì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

**ê·¸ë˜ì„œ Item 27ì—ì„œ ë°°ìš´ `@SuppressWarnings("unchecked")`ë¥¼ ì‚¬ìš©í•´ì„œ ê²½ê³ ë¥¼ ì—†ì• ì£¼ì.**

```java
@SuppressWarnings("unchecked")
public Stack() {
    elements = (E[])new Object[DEFAULT_INITIAL_CAPACITY];
}
```

### ë‘ë²ˆì§¸ í•´ê²°ë°©ì•ˆ

> elements í•„ë“œì˜ íƒ€ì…ì„ E[]ì—ì„œ Object[]ë¡œ ë°”ê¾¸ê¸°

```java
//before
private E[] elements;

//after
private Object[] elements;
```

<p align = "center">
<img width="535" alt="image" src="https://github.com/Growth-Hub/Effective-Java/assets/143387515/5a9fec5c-3e47-474f-96a1-42766cf619e1">
</p>

- í•˜ì§€ë§Œ ì´ë²ˆì—ëŠ” pop()ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
- ë°°ì—´ì„ Object[]ë¡œ ë³€ê²½ë˜ë©´ì„œ ì›ì†Œë“¤ì€ Object íƒ€ì…ì„ ê°€ì§€ê²Œ ë˜ì—ˆë‹¤.
- ê·¸ëŸ¬ë©´ì„œ pop()ì—ì„œ ì›ì†Œë¥¼ êº¼ë‚¼ë•Œ E íƒ€ì…ê³¼ ë§ì§€ ì•Šë‹¤ë¼ëŠ” ì—ëŸ¬ì´ë‹¤.

**ì´ëŠ” ê°„ë‹¨í•˜ê²Œ í˜•ë³€í™˜ (E)ë¥¼ ë„£ì–´ì£¼ë©´ ì‰½ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.**

<p align = "center">
<img width="681" alt="image" src="https://github.com/Growth-Hub/Effective-Java/assets/143387515/049a5369-c135-48fb-8116-a2a74df054a8">
</p>

- ìˆ˜ì • ê²°ê³¼, ì´ì „ê³¼ ë™ì¼í•˜ê²Œ ë¹„ê²€ì‚¬ í˜•ë³€í™˜ìœ¼ë¡œ ê²½ê³ ê°€ ë°œìƒí•œë‹¤.
- ì´ë²ˆì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ ì•ˆì „í•œì§€ ìš°ë¦¬ê°€ ì§ì ‘ ì¦ëª…í•˜ê³  ê²½ê³ ë¥¼ ìˆ¨ê¸°ë©´ ëœë‹¤.

**ì•ˆì „í•œ ì´ìœ ëŠ” ìœ„ì™€ ë™ì¼í•˜ë‹¤.**

1. ë°°ì—´ì´ privateìœ¼ë¡œ ì €ì¥ëœë‹¤.
2. ë°°ì—´ì— ì›ì†Œê°€ ì €ì¥ë˜ëŠ” íƒ€ì…ì€ E ì´ë‹¤.
3. ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ í˜¹ì€ ë‹¤ë¥¸ ë©”ì„œë“œë¡œ ì „ë‹¬ë˜ëŠ” ì¼ì´ ì—†ë‹¤.

> Item 27 ì¡°ì–¸ì— ë”°ë¼ ìµœëŒ€í•œ ì¢ì€ ë²”ìœ„ë¡œ ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í•´ë³´ì.

```java
public E pop() {
    if (size == 0)
        throw new EmptyStackException();

    @SuppressWarnings("unchecked")
    E result = (E)elements[--size];
    
    elements[size] = null; // ë‹¤ ì“´ ì°¸ì¡° í•´ì œ
    return result;
}
```

## ì²«ë²ˆì¨° ë°©ë²• ğŸ†š ë‘ë²ˆì§¸ ë°©ë²•

ê·¸ë ‡ë‹¤ë©´ ì–´ë–¤ ë°©ë²•ì´ ë” ì¢‹ì€ ë°©ì‹ì¼ê¹Œ?

ë‘ ë°©ë²• ëª¨ë‘ ë‚˜ë¦„ ì§€ì§€ë¥¼ ì–»ê³  ìˆë‹¤.

**ë‘ ë°©ì‹ì˜ ì°¨ì´ì ì„ ì•Œì•„ë³´ì.**

### ì°¨ì´ì  1

ì²«ë²ˆì§¸ ë°©ì‹ì˜ ê²½ìš°,

- ë°°ì—´ íƒ€ì…ì„ E[]ë¡œ ì„ ì–¸í•´ì„œ **E íƒ€ì… ì›ì†Œë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ í™•ì‹¤íˆ ì•Œ ìˆ˜ ìˆë‹¤.**
- ì½”ë“œë„ ì§§ë‹¤.
- í˜•ë³€í™˜ì„ í•œë²ˆë§Œ í•´ì£¼ë©´ ëœë‹¤.

ë°˜ë©´ ë‘ë²ˆì§¸ ë°©ì‹ì˜ ê²½ìš°,

- ë°°ì—´ì˜ ì›ì†Œë¥¼ ì½ì„ë•Œë§ˆë‹¤ í˜•ë³€í™˜ì´ ë°œìƒí•œë‹¤.

## ì°¨ì´ì  2

ì²«ë²ˆì§¸ ë°©ì‹ì˜ ê²½ìš°,

- `í™ ì˜¤ì—¼(heap pollution)`ì„ ì¼ìœ¼í‚¨ë‹¤.

ë°˜ë©´ ë‘ë²ˆì§¸ ë°©ì‹ì˜ ê²½ìš°

- í™ ì˜¤ì—¼ì„ ì¼ìœ¼í‚¤ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ë˜ì„œ ì²«ë²ˆì¬ ë°©ì‹ì´ ì£¼ë¡œ ì‚¬ìš©ë˜ê¸´í•˜ì§€ë§Œ, í™ì˜¤ì—¼ì´ ê±¸ë¦°ë‹¤ë©´ ë‘ë²ˆì§¸ ë°©ì‹ì„ ê³ ìˆ˜í•˜ê¸°ë„ í•œë‹¤.

### í™ì˜¤ì—¼ì´ë€?

- JVMì˜ í™ ì˜ì—­ì— ì €ì¥ë˜ì–´ìˆëŠ” **íŠ¹ì • ê°ì²´ê°€ ë¶ˆëŸ‰ìœ¼ë¡œ ì €ì¥ë˜ì–´**, í™ ì˜ì—­ì„ ì˜¤ì—¼ì‹œí‚¤ëŠ” ê²ƒ
- ì»´íŒŒì¼ì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì§€ë§Œ, ëŸ°íƒ€ì„ ì‹œì ì— `ClassCastException`ì´ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.
- ì£¼ë¡œ ì œë„¤ë¦­ì„ ì‚¬ìš©í• ë•Œ ìì£¼ ë°œìƒí•œë‹¤.

> ì²«ë²ˆì§¸ ë°©ì‹ Stack ì½”ë“œ í™ì˜¤ì—¼ ì˜ˆì‹œ

```java
public static void main(String[] args) {

    final Stack<Pizza> stack1 = new Stack<>();
    
    final Pizza pizza = new Pizza();
    stack1.push(pizza);
    
    // ìƒìœ„ íƒ€ì…ìœ¼ë¡œ ë³€í™˜ í›„ ì‘ì—…í•  ê²ƒì´ ìˆì–´ì„œ Upcasting ì§„í–‰
    Object obj = stack1;
    
    /*
    ë¡œì§ í•œì°¸ ëŒë¦° í›„
    */
    
    // ë˜ëŒë¦¬ëŠ” ê³¼ì •ì—ì„œ ì‹¤ìˆ˜ë¡œ ë§¤ê°œë³€ìˆ˜ íƒ€ì… Chicken ì§€ì •
    Stack<Chicken> stack2 = (Stack<Chicken>)obj;
    
    final Chicken chicken = new Chicken();
    stack2.push(chicken);          // [ì˜¤ì—¼] stack2.elements = [ Pizza, Chicken ]
    
    System.out.println(stack2.size);                // 2
    System.out.println(stack2.pop().getClass());    // class Item_29.Chicken
    System.out.println(stack2.pop().getClass());    // !!ClassCastException Error!!
    
}
```

<p align = "center">
<img width="958" alt="image" src="https://github.com/Growth-Hub/Effective-Java/assets/143387515/76b566e8-1c9f-4ddf-bae2-b3e37b5126da">
</p>

- íƒ€ì… ìºìŠ¤íŒ… ì²´í¬ëŠ” ì»´íŒŒì¼ëŸ¬ê°€ í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, `unchecked ìºìŠ¤íŒ…` í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ ì£¼ë¡œ ë°œìƒí•œë‹¤.
- ìœ„ ì˜ˆì‹œì—ì„œëŠ” `Pizza` -> `Object` -> `Chicken` ìœ¼ë¡œ íƒ€ì…ì´ ë°”ë€Œë©´ì„œ í™ì˜¤ì—¼ì´ ë°œìƒí–ˆë‹¤. 

## ğŸ¤” ì ê¹, ë¦¬ìŠ¤íŠ¸ê°€ ë” ì¢‹ë‹¤ê³  í•˜ì§€ ì•Šì•˜ë‚˜?

ì§ì ‘ Item 28ì—ì„œ "ë°°ì—´ë³´ë‹¤ ë¦¬ìŠ¤íŠ¸ë¥¼ ìš°ì„ í•˜ë¼" ë¼ê³  ì–˜ê¸°í–ˆë‹¤.

ê·¸ëŸ°ë° ì´ë²ˆ ì˜ˆì‹œì—ì„œëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ì•ˆì“°ê³  ë°°ì—´ì„ ì¼ì„ê¹Œ?

ì œë„¤ë¦­ íƒ€ì… ì•ˆì—ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²Œ í•­ìƒ ì¢‹ì€ ê²ƒì€ ì•„ë‹ˆë‹¤.

> ArrayList.class

```java
public class ArrayList<E> extends AbstractList<E>
        implements List<E>, RandomAccess, Cloneable, java.io.Serializable 
{
    ...
   
    private static final Object[] EMPTY_ELEMENTDATA = {};
    private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
    transient Object[] elementData;
    
    ..
}
```
- ìë°”ê°€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ArrayList ë˜í•œ ë‚´ë¶€ì ìœ¼ë¡œ ë°°ì—´ì„ ì‚¬ìš©í•œë‹¤.
- HashMap ë˜í•œ ì„±ëŠ¥ì„ ë†’ì´ê¸° ìœ„í•´ ë‚´ë¶€ì—ì„œ ë°°ì—´ì„ ì‚¬ìš©í•œë‹¤.

### ğŸ“š ì •ë¦¬

ì œë„¤ë¦­ì€ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆë‹¤.

1. ì‚¬ìš©ìê°€ ì§ì ‘ í˜•ë³€í™˜í•  í•„ìš” ì—†ë‹¤.
2. ê·¸ëŸ¬ë¯€ë¡œ ì˜ëª¯ëœ í˜•ë³€í™˜í•˜ëŠ” ê³¼ì •ìœ¼ë¡œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œë¥¼ ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ ëœë‹¤.
3. ì‚¬ìš©ìê°€ ì‚¬ìš©í•˜ê¸° í¸í•˜ë‹¤.

**ì œë„¤ë¦­ íƒ€ì…ì´ í›¨ì”¬ ì•ˆì „í•˜ê¸° ë•Œë¬¸ì—, ì›¬ë§Œí•´ì„œëŠ” ì œë„¤ë¦­ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ì.**

### ğŸ“ Reference 
[í™ ì˜¤ì—¼](https://inpa.tistory.com/entry/JAVA-%E2%98%95-%EC%A0%9C%EB%84%A4%EB%A6%AD-%ED%9E%99-%EC%98%A4%EC%97%BC-Heap-Pollution-%EC%9D%B4%EB%9E%80)

